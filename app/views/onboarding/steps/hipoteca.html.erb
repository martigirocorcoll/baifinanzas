<%= render 'onboarding/step_layout',
    step_number: @step_number,
    total_steps: @total_steps,
    progress: @progress,
    title: t('onboarding.steps.hipoteca.title'),
    subtitle: t('onboarding.steps.hipoteca.subtitle') do %>

  <%= form_tag onboarding_step_path(step_name: 'hipoteca'), method: :post, class: 'onboarding-form' do %>
    <%= hidden_field_tag :from, @from %>

    <div class="onboarding-toggle" id="mortgageToggle">
      <button type="button" class="onboarding-toggle__btn <%= 'onboarding-toggle__btn--active' if @toggle == 'yes' %>" data-value="yes">
        <%= t('onboarding.yes') %>
      </button>
      <button type="button" class="onboarding-toggle__btn <%= 'onboarding-toggle__btn--active' if @toggle == 'no' %>" data-value="no">
        <%= t('onboarding.no') %>
      </button>
      <%= hidden_field_tag :toggle, @toggle, id: 'toggleField' %>
    </div>

    <div class="onboarding-input-group onboarding-expandable" id="mortgageAmount" style="<%= 'display: none;' unless @toggle == 'yes' %>">
      <div class="onboarding-input-wrap onboarding-input-wrap--euro">
        <span class="onboarding-input-wrap__prefix">EUR</span>
        <%= number_field_tag :value, @value, class: 'onboarding-input', placeholder: '150.000', min: 0, step: 1, inputmode: 'numeric' %>
      </div>
      <span class="onboarding-input-hint"><%= t('onboarding.steps.hipoteca.hint') %></span>
    </div>

    <button type="submit" class="btn-app btn-app--primary btn-app--block onboarding-submit">
      <%= t('onboarding.next') %>
    </button>
  <% end %>

<% end %>

<script>
(function() {
  function initToggle() {
    var toggleBtns = document.querySelectorAll('#mortgageToggle .onboarding-toggle__btn');
    var toggleField = document.getElementById('toggleField');
    var amountDiv = document.getElementById('mortgageAmount');
    if (!toggleBtns.length) return;

    toggleBtns.forEach(function(btn) {
      btn.addEventListener('click', function() {
        toggleBtns.forEach(function(b) { b.classList.remove('onboarding-toggle__btn--active'); });
        btn.classList.add('onboarding-toggle__btn--active');
        toggleField.value = btn.dataset.value;

        if (btn.dataset.value === 'yes') {
          amountDiv.style.display = '';
          var input = amountDiv.querySelector('input');
          if (input) input.focus();
        } else {
          amountDiv.style.display = 'none';
        }
      });
    });
  }
  document.addEventListener('turbo:load', initToggle);
  if (document.readyState !== 'loading') { initToggle(); }
  else { document.addEventListener('DOMContentLoaded', initToggle); }
})();
</script>
