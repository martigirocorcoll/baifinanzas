<!DOCTYPE html>
<html lang="<%= I18n.locale %>">
  <head>
    <title><%= content_for(:title) || "Finex Admin" %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="admin-layout">
    <div class="d-flex" style="min-height: 100vh;">
      <%# Sidebar %>
      <nav class="admin-sidebar bg-dark text-white d-flex flex-column" style="width: 250px; min-height: 100vh; position: fixed; top: 0; left: 0; z-index: 1000;">
        <div class="p-3 border-bottom border-secondary">
          <h5 class="mb-0">
            <i class="bi bi-shield-lock-fill text-info"></i>
            Finex
          </h5>
          <small class="text-secondary">Panel de Administracion</small>
        </div>

        <ul class="nav flex-column p-2 flex-grow-1">
          <li class="nav-item">
            <%= link_to admin_root_path, class: "nav-link text-white #{'active bg-secondary bg-opacity-25 rounded' if controller_path == 'admin/dashboard'}" do %>
              <i class="bi bi-speedometer2 me-2"></i> Dashboard
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to admin_users_path, class: "nav-link text-white #{'active bg-secondary bg-opacity-25 rounded' if controller_path == 'admin/users'}" do %>
              <i class="bi bi-people me-2"></i> Usuarios
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to admin_articles_path, class: "nav-link text-white #{'active bg-secondary bg-opacity-25 rounded' if controller_path == 'admin/articles'}" do %>
              <i class="bi bi-newspaper me-2"></i> Articulos
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to admin_app_news_index_path, class: "nav-link text-white #{'active bg-secondary bg-opacity-25 rounded' if controller_path == 'admin/app_news'}" do %>
              <i class="bi bi-megaphone me-2"></i> Noticias
            <% end %>
          </li>
          <li class="nav-item">
            <%= link_to admin_influencers_path, class: "nav-link text-white #{'active bg-secondary bg-opacity-25 rounded' if controller_path == 'admin/influencers'}" do %>
              <i class="bi bi-star me-2"></i> Influencers
            <% end %>
          </li>
        </ul>

        <div class="p-3 border-top border-secondary">
          <div class="d-flex align-items-center gap-2 mb-2">
            <i class="bi bi-person-circle"></i>
            <small><%= current_user&.email&.truncate(20) %></small>
          </div>
          <%= link_to home_path, class: "btn btn-outline-light btn-sm w-100 mb-2" do %>
            <i class="bi bi-arrow-left me-1"></i> Volver a la app
          <% end %>
          <%= button_to destroy_user_session_path, method: :delete, class: "btn btn-outline-danger btn-sm w-100" do %>
            <i class="bi bi-box-arrow-right me-1"></i> Cerrar sesion
          <% end %>
        </div>
      </nav>

      <%# Main content %>
      <div class="flex-grow-1" style="margin-left: 250px;">
        <%# Top bar %>
        <header class="bg-white border-bottom px-4 py-3 d-flex justify-content-between align-items-center">
          <h4 class="mb-0"><%= content_for(:page_title) || "Dashboard" %></h4>
          <div class="text-muted">
            <small><%= Time.current.strftime("%d %b %Y") %></small>
          </div>
        </header>

        <%# Flash messages %>
        <div class="px-4 pt-3">
          <% if notice.present? %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              <i class="bi bi-check-circle-fill me-1"></i> <%= notice %>
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          <% end %>
          <% if alert.present? %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-1"></i> <%= alert %>
              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
          <% end %>
        </div>

        <%# Page content %>
        <div class="p-4">
          <%= yield %>
        </div>
      </div>
    </div>
  </body>
</html>
