<% content_for :title, t('profile.nav_title', default: 'Perfil') %>
<div class="app-container">
  <%# User info header %>
  <% user_name = @user.email.split('@').first.capitalize %>
  <% initials = user_name[0..1].upcase %>
  <div class="text-center mb-4">
    <div class="profile-avatar profile-avatar--initials mb-3">
      <span><%= initials %></span>
    </div>
    <h2 class="h5 mb-1"><%= user_name %></h2>
    <p class="text-muted small mb-2"><%= @user.email %></p>
    <span class="level-badge level-badge--pill level-badge--<%= @financial_level %>">
      <%= t("financial.levels.#{@financial_level_key}.name") %>
    </span>
  </div>

  <%# Level + stats summary %>
  <div class="profile-stats">
    <div class="profile-stats__item">
      <span class="profile-stats__value"><%= @actions_completed %>/<%= @actions_total %></span>
      <span class="profile-stats__label"><%= t('profile.actions_completed') %></span>
    </div>
    <div class="profile-stats__divider"></div>
    <div class="profile-stats__item">
      <span class="profile-stats__value"><%= @objectives_count %></span>
      <span class="profile-stats__label"><%= t('profile.objectives_created') %></span>
    </div>
    <div class="profile-stats__divider"></div>
    <div class="profile-stats__item">
      <span class="profile-stats__value"><%= @member_since.strftime('%b %y') %></span>
      <span class="profile-stats__label"><%= t('profile.member_since') %></span>
    </div>
  </div>

  <%# Go to plan link %>
  <%= link_to authenticated_root_path, class: 'profile-plan-link' do %>
    <i class="bi bi-list-check"></i>
    <span><%= t('profile.go_to_plan') %></span>
    <i class="bi bi-arrow-right ms-auto"></i>
  <% end %>

  <%# Profile completion with checklist %>
  <% if @profile_completion < 100 %>
    <div class="app-card mb-4" style="border: 2px solid #f59e0b; background: #fffbeb;">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="fw-bold" style="color: #92400e;"><%= t('profile.completion') %></span>
        <span class="fw-bold" style="color: #92400e; font-size: 1.1rem;"><%= @profile_completion %>%</span>
      </div>
      <div class="progress mb-3" style="height: 8px; background: #fde68a;">
        <div class="progress-bar" style="width: <%= @profile_completion %>%; background: #f59e0b;"></div>
      </div>

      <%# Step 1: Account - always done %>
      <div class="d-flex align-items-center gap-2 py-2">
        <i class="bi bi-check-circle-fill text-success"></i>
        <span class="small" style="color: #166534;"><%= t('profile.step_account', default: 'Cuenta creada') %></span>
      </div>

      <%# Step 2: PyG %>
      <% if @has_pyg %>
        <div class="d-flex align-items-center gap-2 py-2">
          <i class="bi bi-check-circle-fill text-success"></i>
          <span class="small" style="color: #166534;"><%= t('profile.income_expenses') %></span>
        </div>
      <% else %>
        <%= link_to edit_pyg_path, class: 'd-flex align-items-center gap-2 py-2 text-decoration-none' do %>
          <i class="bi bi-circle" style="color: #d97706;"></i>
          <span class="small fw-semibold" style="color: #92400e;"><%= t('profile.income_expenses') %></span>
          <span class="badge rounded-pill ms-auto" style="background: #f59e0b; font-size: 0.65rem;"><%= t('profile.step_time_2min', default: '2 min') %></span>
          <i class="bi bi-chevron-right" style="color: #d97706; font-size: 0.75rem;"></i>
        <% end %>
      <% end %>

      <%# Step 3: Balance %>
      <% if @has_balance %>
        <div class="d-flex align-items-center gap-2 py-2">
          <i class="bi bi-check-circle-fill text-success"></i>
          <span class="small" style="color: #166534;"><%= t('profile.assets_debts') %></span>
        </div>
      <% else %>
        <%= link_to edit_balance_path, class: 'd-flex align-items-center gap-2 py-2 text-decoration-none' do %>
          <i class="bi bi-circle" style="color: #d97706;"></i>
          <span class="small fw-semibold" style="color: #92400e;"><%= t('profile.assets_debts') %></span>
          <span class="badge rounded-pill ms-auto" style="background: #f59e0b; font-size: 0.65rem;"><%= t('profile.step_time_2min', default: '2 min') %></span>
          <i class="bi bi-chevron-right" style="color: #d97706; font-size: 0.75rem;"></i>
        <% end %>
      <% end %>

      <%# Step 4: Objectives (only if level requires it) %>
      <% if @needs_objectives %>
        <% if @has_objectives %>
          <div class="d-flex align-items-center gap-2 py-2">
            <i class="bi bi-check-circle-fill text-success"></i>
            <span class="small" style="color: #166534;"><%= t('profile.step_first_objective', default: 'Primer objetivo definido') %></span>
          </div>
        <% else %>
          <%= link_to authenticated_root_path, class: 'd-flex align-items-center gap-2 py-2 text-decoration-none' do %>
            <i class="bi bi-circle" style="color: #d97706;"></i>
            <span class="small fw-semibold" style="color: #92400e;"><%= t('profile.step_first_objective', default: 'Primer objetivo definido') %></span>
            <span class="badge rounded-pill ms-auto" style="background: #f59e0b; font-size: 0.65rem;"><%= t('profile.step_time_1min', default: '1 min') %></span>
            <i class="bi bi-chevron-right" style="color: #d97706; font-size: 0.75rem;"></i>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>

  <%# Menu sections %>
  <div class="app-section">
    <h3 class="app-section__title"><%= t('profile.financial_data') %></h3>

    <%= link_to edit_pyg_path, class: 'profile-menu-item' do %>
      <div class="profile-menu-item__icon-wrap">
        <i class="bi bi-cash-stack text-brand"></i>
      </div>
      <div class="profile-menu-item__content">
        <h4 class="profile-menu-item__title"><%= t('profile.income_expenses', default: 'Ingresos y gastos') %></h4>
        <% if @has_pyg %>
          <p class="profile-menu-item__subtitle text-success mb-0"><i class="bi bi-check-circle me-1"></i><%= t('profile.completed', default: 'Completado') %></p>
        <% else %>
          <p class="profile-menu-item__subtitle mb-0"><%= t('profile.pending', default: 'Pendiente') %></p>
        <% end %>
      </div>
      <i class="bi bi-chevron-right profile-menu-item__arrow"></i>
    <% end %>

    <%= link_to edit_balance_path, class: 'profile-menu-item' do %>
      <div class="profile-menu-item__icon-wrap">
        <i class="bi bi-bank text-brand"></i>
      </div>
      <div class="profile-menu-item__content">
        <h4 class="profile-menu-item__title"><%= t('profile.assets_debts', default: 'Activos y deudas') %></h4>
        <% if @has_balance %>
          <p class="profile-menu-item__subtitle text-success mb-0"><i class="bi bi-check-circle me-1"></i><%= t('profile.completed', default: 'Completado') %></p>
        <% else %>
          <p class="profile-menu-item__subtitle mb-0"><%= t('profile.pending', default: 'Pendiente') %></p>
        <% end %>
      </div>
      <i class="bi bi-chevron-right profile-menu-item__arrow"></i>
    <% end %>
  </div>

  <div class="app-section">
    <h3 class="app-section__title"><%= t('profile.account', default: 'Cuenta') %></h3>

    <%= link_to edit_profile_path, class: 'profile-menu-item' do %>
      <div class="profile-menu-item__icon-wrap">
        <i class="bi bi-person-gear text-brand"></i>
      </div>
      <div class="profile-menu-item__content">
        <h4 class="profile-menu-item__title"><%= t('profile.personal_data', default: 'Datos personales') %></h4>
        <p class="profile-menu-item__subtitle mb-0"><%= t('profile.name_email_password', default: 'Nombre, email, contrasena') %></p>
      </div>
      <i class="bi bi-chevron-right profile-menu-item__arrow"></i>
    <% end %>

    <%= link_to profile_settings_path, class: 'profile-menu-item' do %>
      <div class="profile-menu-item__icon-wrap">
        <i class="bi bi-gear text-brand"></i>
      </div>
      <div class="profile-menu-item__content">
        <h4 class="profile-menu-item__title"><%= t('profile.settings', default: 'Configuracion') %></h4>
        <p class="profile-menu-item__subtitle mb-0"><%= t('profile.language_notifications', default: 'Idioma, notificaciones') %></p>
      </div>
      <i class="bi bi-chevron-right profile-menu-item__arrow"></i>
    <% end %>
  </div>

  <%# Logout %>
  <div class="mt-4">
    <%= button_to destroy_user_session_path,
        method: :delete,
        class: 'btn-app btn-app--secondary btn-app--block',
        data: { turbo: false } do %>
      <i class="bi bi-box-arrow-right"></i>
      <%= t('profile.logout', default: 'Cerrar sesion') %>
    <% end %>
  </div>

  <%# Version info %>
  <p class="text-center text-muted small mt-4">
    BaiFinanzas v1.0.0
  </p>
</div>
