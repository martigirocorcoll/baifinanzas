<% content_for :title, t('objectives.processing.title', default: 'Calculando...') %>

<div class="onboarding-processing">
  <div class="onboarding-processing__content">
    <div class="processing-icon-container">
      <i class="bi bi-bullseye processing-icon"></i>
      <div class="processing-ring"></div>
      <div class="processing-ring-2"></div>
    </div>

    <h1 class="onboarding-processing__title"><%= t('objectives.processing.title', default: 'Analizando tu objetivo') %></h1>
    <p class="onboarding-processing__desc"><%= t('objectives.processing.description', default: 'Preparando tu plan personalizado...') %></p>

    <div class="processing-steps">
      <div class="processing-step" id="step-1">
        <i class="bi bi-check-circle-fill"></i>
        <span><%= t('objectives.processing.step_1', default: 'Calculando ahorro necesario') %></span>
      </div>
      <div class="processing-step" id="step-2">
        <i class="bi bi-check-circle-fill"></i>
        <span><%= t('objectives.processing.step_2', default: 'Buscando la mejor inversion') %></span>
      </div>
      <div class="processing-step" id="step-3">
        <i class="bi bi-check-circle-fill"></i>
        <span><%= t('objectives.processing.step_3', default: 'Generando tu plan de accion') %></span>
      </div>
    </div>

    <div class="progress mx-auto" style="max-width: 300px; height: 6px;">
      <div class="progress-bar progress-bar-animated" role="progressbar" style="width: 0%; background-color: #165668;" id="progress-bar"></div>
    </div>
  </div>
</div>

<style>
.onboarding-processing {
  min-height: var(--app-content-height, 100dvh);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
}
.onboarding-processing__content { text-align: center; max-width: 400px; }
.onboarding-processing__title { font-size: 1.4rem; font-weight: 700; color: #1a1a1a; margin: 1.5rem 0 0.5rem; }
.onboarding-processing__desc { font-size: 0.95rem; color: #6b7280; margin-bottom: 2rem; }
.processing-icon-container { position: relative; width: 100px; height: 100px; margin: 0 auto; }
.processing-icon { font-size: 3rem; color: #165668; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: pulse 2s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; } }
.processing-ring, .processing-ring-2 { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 3px solid transparent; border-top-color: #165668; border-radius: 50%; animation: spin 1.5s linear infinite; }
.processing-ring-2 { border-top-color: #1d7a8c; animation: spin 2s linear infinite reverse; opacity: 0.5; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.processing-steps { max-width: 320px; margin: 0 auto 2rem; text-align: left; }
.processing-step { display: flex; align-items: center; gap: 10px; padding: 10px 12px; margin-bottom: 6px; background: #f9fafb; border-radius: 10px; opacity: 0.3; transition: opacity 0.5s ease; }
.processing-step i { font-size: 1.1rem; color: #165668; opacity: 0; transition: opacity 0.5s ease; }
.processing-step.active { opacity: 1; }
.processing-step.active i { opacity: 1; }
.processing-step span { font-weight: 500; color: #6b7280; font-size: 0.9rem; }
</style>

<script>
(function() {
  function initProcessing() {
    var steps = ['step-1', 'step-2', 'step-3'];
    var progressBar = document.getElementById('progress-bar');
    if (!progressBar) return;
    var currentStep = 0;

    function activateStep(index) {
      if (index < steps.length) {
        var stepEl = document.getElementById(steps[index]);
        if (stepEl) stepEl.classList.add('active');
        progressBar.style.width = ((index + 1) / steps.length * 100) + '%';
        currentStep++;
        if (currentStep < steps.length) {
          setTimeout(function() { activateStep(currentStep); }, 1000);
        } else {
          setTimeout(function() {
            window.location.href = '<%= home_path %>';
          }, 500);
        }
      }
    }

    setTimeout(function() { activateStep(0); }, 300);
  }

  document.addEventListener('turbo:load', initProcessing);
  if (document.readyState !== 'loading') { initProcessing(); }
  else { document.addEventListener('DOMContentLoaded', initProcessing); }
})();
</script>
