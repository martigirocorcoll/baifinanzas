<% content_for :title, t('objectives.update_progress.title', default: 'Actualizar progreso') %>

<div style="padding: 1rem;">
  <div class="app-card">
    <div class="app-card__header">
      <h2 class="app-card__title">
        <i class="bi bi-pencil-square"></i>
        <%= t('objectives.update_progress.title', default: 'Actualizar progreso') %>
      </h2>
    </div>
    <div class="app-card__body">
      <%# Objective context %>
      <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: #f9fafb; border-radius: 8px; margin-bottom: 1.25rem;">
        <span style="font-size: 1.5rem;"><%= @objective.objective_icon_emoji %></span>
        <div>
          <h4 style="font-size: 0.9375rem; font-weight: 600; color: #1a1a1a; margin: 0;">
            <%= @objective.title %>
          </h4>
          <p style="font-size: 0.8125rem; color: #6b7280; margin: 0.125rem 0 0;">
            <%= t('objectives.update_progress.target', default: 'Objetivo:') %>
            <%= number_to_currency(@objective.target_amount, unit: "\u20AC", precision: 0) %>
          </p>
        </div>
      </div>

      <%# Progress bar %>
      <% progress = @objective.current_progress_percentage %>
      <div style="margin-bottom: 1.25rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.375rem;">
          <span style="font-size: 0.8125rem; color: #6b7280;">
            <%= t('objectives.update_progress.current_progress', default: 'Progreso actual') %>
          </span>
          <span style="font-size: 0.875rem; font-weight: 600; color: #165668;"><%= progress.round(0) %>%</span>
        </div>
        <div style="height: 8px; background: #e5e7eb; border-radius: 999px; overflow: hidden;">
          <div style="height: 100%; width: <%= [progress, 100].min %>%; background: #10b981; border-radius: 999px; transition: width 0.3s ease;"></div>
        </div>
      </div>

      <%# Form %>
      <%= form_with url: update_progress_objective_path(@objective), method: :patch do |f| %>
        <div class="app-form__group">
          <label class="app-form__label">
            <%= t('objectives.update_progress.new_amount', default: 'Cantidad ahorrada') %>
          </label>
          <div class="app-form__input-group">
            <span class="app-form__input-prefix">&euro;</span>
            <input type="number" name="current_amount" value="<%= @objective.current_amount %>"
                   min="0" step="100" class="app-form__input" autofocus
                   placeholder="<%= t('objectives.update_progress.amount_placeholder', default: '0') %>">
          </div>
          <p class="app-form__hint">
            <%= t('objectives.update_progress.hint',
                default: 'Introduce el total que llevas ahorrado para este objetivo') %>
          </p>
        </div>

        <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
          <%= link_to home_path, class: 'btn btn-light', style: 'flex: 1; text-align: center;' do %>
            <%= t('common.cancel', default: 'Cancelar') %>
          <% end %>
          <button type="submit" class="btn btn-primary" style="flex: 1;">
            <%= t('objectives.update_progress.save', default: 'Guardar') %>
          </button>
        </div>
      <% end %>
    </div>
  </div>
</div>
